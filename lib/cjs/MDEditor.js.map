{"version":3,"sources":["../../src/MDEditor.tsx"],"names":["MDEditor","props","preview","React","createRef","textarea","commandOrchestrator","leftScroll","handleScroll","e","current","mdp","warp","scale","scrollHeight","offsetHeight","target","scrollTop","handleCommand","command","keyCommand","setState","value","fullscreen","state","document","body","style","overflow","executeCommand","height","handleChange","TextAreaCommandOrchestrator","text","nextProps","mdStr","onChange","renderHTML","prefixCls","className","commands","visiableDragbar","previewOptions","textareaProps","maxHeight","minHeight","autoFocus","tabSize","other","cls","test","bind","newHeight","PureComponent","Markdown","MarkdownPreview","displayName","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport classnames from 'classnames';\nimport { ReactMarkdownProps } from 'react-markdown';\nimport MarkdownPreview from '@uiw/react-markdown-preview';\nimport { IProps } from './utils';\nimport TextArea, { ITextAreaProps } from './components/TextArea';\nimport Toolbar from './components/Toolbar';\nimport DragBar from './components/DragBar';\nimport { getCommands, TextAreaCommandOrchestrator, ICommand, CommandOrchestrator } from './commands';\nimport './index.less';\n\nexport interface MDEditorProps extends Omit<React.HTMLAttributes<HTMLDivElement>, 'onChange'>, IProps {\n  /**\n   * The Markdown value.\n   */\n  value?: string;\n  /**\n   * Event handler for the `onChange` event.\n   */\n  onChange?: (value?: string) => void;\n  /**\n   * Can be used to make `Markdown Editor` focus itself on initialization. Defaults to on.\n   * it will be set to true when either the source `textarea` is focused,\n   * or it has an `autofocus` attribute and no other element is focused.\n   */\n  autoFocus?: ITextAreaProps['autoFocus'];\n  /**\n   * The height of the editor.\n   */\n  height?: React.CSSProperties['height'];\n  /**\n   * Show drag and drop tool. Set the height of the editor.\n   */\n  visiableDragbar?: boolean;\n  /**\n   * Show markdown preview.\n   */\n  preview?: 'live' | 'edit' | 'preview';\n  fullscreen?: boolean;\n  /**\n   * Maximum drag height. `visiableDragbar=true`\n   */\n  maxHeight?: number;\n  /**\n   * Minimum drag height. `visiableDragbar=true`\n   */\n  minHeight?: number;\n  /**\n   * This is reset [react-markdown](https://github.com/rexxars/react-markdown) settings.\n   */\n  previewOptions?: ReactMarkdownProps;\n  /**\n   * Set the `textarea` related props.\n   */\n  textareaProps?: ITextAreaProps;\n  /**\n   * The number of characters to insert when pressing tab key.\n   * Default `2` spaces.\n   */\n  tabSize?: number;\n  /**\n   * You can create your own commands or reuse existing commands.\n   */\n  commands?: ICommand[];\n}\n\nexport interface MDEditorState {\n  height: React.CSSProperties['height'];\n  preview?: MDEditorProps['preview'];\n  fullscreen?: boolean;\n  value?: string;\n}\n\nexport default class MDEditor extends React.PureComponent<MDEditorProps, MDEditorState> {\n  static Markdown = MarkdownPreview;\n  public static displayName = 'MDEditor';\n  public preview = React.createRef<MarkdownPreview>();\n  public textarea = React.createRef<TextArea>();\n  public commandOrchestrator!: CommandOrchestrator;\n  public leftScroll:boolean = false;\n  public static defaultProps: MDEditorProps = {\n    value: '',\n    prefixCls: 'w-md-editor',\n    height: 200,\n    minHeight: 100,\n    maxHeight: 1200,\n    tabSize: 2,\n    visiableDragbar: true,\n    preview: 'live',\n    fullscreen: false,\n    commands: getCommands(),\n  }\n  public constructor(props: MDEditorProps) {\n    super(props);\n    this.state = {\n      height: props.height,\n      preview: props.preview,\n      fullscreen: props.fullscreen,\n      value: props.value,\n    };\n  }\n  public componentDidMount() {\n    this.handleChange(this.state.value);\n    this.commandOrchestrator = new TextAreaCommandOrchestrator(this.textarea.current!.text.current as HTMLTextAreaElement);\n  }\n  public UNSAFE_componentWillReceiveProps(nextProps: MDEditorProps) {\n    if (nextProps.preview !== this.props.preview) {\n      this.setState({ preview: nextProps.preview });\n    }\n    if (nextProps.fullscreen !== this.props.fullscreen) {\n      this.setState({ fullscreen: nextProps.fullscreen });\n    }\n    if (nextProps.value !== this.props.value) {\n      this.setState({ value: nextProps.value }, () => {\n        this.handleChange(nextProps.value);\n      });\n    }\n  }\n  private handleScroll = (e: React.UIEvent<HTMLDivElement>) => {\n    const preview = this.preview.current!.mdp.current! as HTMLDivElement;\n    const textarea = this.textarea.current!.warp.current! as HTMLDivElement;\n    if (textarea && preview) {\n      const scale = (textarea.scrollHeight - textarea.offsetHeight) / (preview.scrollHeight - preview.offsetHeight);\n      if (e.target === textarea && this.leftScroll) {\n        preview.scrollTop = textarea.scrollTop / scale;\n      }\n      if (e.target === preview && !this.leftScroll) {\n        textarea.scrollTop = preview.scrollTop * scale;\n      }\n    }\n  }\n  private handleChange(mdStr?: string) {\n    const { onChange } = this.props;\n    this.preview.current!.renderHTML(mdStr);\n    onChange && onChange(mdStr || '');\n  }\n  public handleCommand = (command: ICommand) => {\n    if (command.keyCommand === 'preview') {\n      this.setState({ preview: command.value as MDEditorState['preview'] });\n    }\n    if (command.keyCommand === 'fullscreen') {\n      this.setState({ fullscreen: !this.state.fullscreen });\n      document.body.style.overflow = this.state.fullscreen ? 'initial' : 'hidden';\n    }\n    this.commandOrchestrator.executeCommand(command);\n  }\n  public render() {\n    const { prefixCls, className, value, commands, height, visiableDragbar, preview, fullscreen, previewOptions, textareaProps, maxHeight, minHeight, autoFocus, tabSize, onChange, ...other } = this.props;\n    const cls = classnames(className, prefixCls, {\n      [`${prefixCls}-show-${this.state.preview}`]: this.state.preview,\n      [`${prefixCls}-fullscreen`]: this.state.fullscreen,\n    });\n    return (\n      <div className={cls} style={{ height: this.state.fullscreen ? '100%' : this.state.height }} {...other}>\n        <Toolbar\n          active={{\n            fullscreen: this.state.fullscreen,\n            preview: this.state.preview,\n          }}\n          prefixCls={prefixCls} commands={commands}\n          onCommand={this.handleCommand}\n        />\n        <div\n          className={`${prefixCls}-content`}\n          style={{ height: this.state.fullscreen ? 'calc(100% - 29px)' : (this.state.height as number) - 29 }}\n        >\n          {/(edit|live)/.test(this.state.preview as string) && (\n            <TextArea\n              ref={this.textarea}\n              tabSize={tabSize}\n              className={`${prefixCls}-input`}\n              prefixCls={prefixCls}\n              value={this.state.value}\n              autoFocus={autoFocus}\n              {...textareaProps}\n              onScroll={this.handleScroll}\n              onMouseOver={() => this.leftScroll = true}\n              onMouseLeave={() => this.leftScroll = false}\n              onChange={this.handleChange.bind(this)}\n            />\n          )}\n          <MarkdownPreview\n            {...previewOptions}\n            ref={this.preview}\n            onScroll={this.handleScroll}\n            className={`${prefixCls}-preview`}\n          />\n          {visiableDragbar && this.state.preview !== 'preview' && !this.state.fullscreen && (\n            <DragBar\n              prefixCls={prefixCls}\n              height={this.state.height as number}\n              maxHeight={maxHeight!}\n              minHeight={minHeight!}\n              onChange={(newHeight) => {\n                this.setState({ height: newHeight });\n              }}\n            />\n          )}\n        </div>\n      </div>\n    )\n  }\n}\n"]}